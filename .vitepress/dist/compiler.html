<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Online Code Compiler</title>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css"
		/>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: #1e1e1e;
				color: #fff;
				height: 100vh;
				display: flex;
				flex-direction: column;
			}
			.header {
				background: #2d2d30;
				padding: 15px 20px;
				border-bottom: 2px solid #007acc;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}
			.header h1 {
				font-size: 24px;
				color: #007acc;
			}
			.controls {
				display: flex;
				gap: 10px;
				align-items: center;
			}
			select,
			button {
				padding: 8px 16px;
				border: none;
				border-radius: 4px;
				font-size: 14px;
				cursor: pointer;
				transition: all 0.3s;
			}
			select {
				background: #3c3c3c;
				color: #fff;
			}
			button {
				background: #007acc;
				color: #fff;
				font-weight: bold;
			}
			button:hover {
				background: #005a9e;
			}
			button:disabled {
				background: #555;
				cursor: not-allowed;
			}
			.clear-btn {
				background: #d9534f;
			}
			.clear-btn:hover {
				background: #c9302c;
			}
			.container {
				display: flex;
				flex: 1;
				overflow: hidden;
			}
			.editor-section {
				flex: 1;
				display: flex;
				flex-direction: column;
				border-right: 2px solid #007acc;
			}
			.CodeMirror {
				flex: 1;
				font-size: 14px;
				height: 100%;
			}
			.output-section {
				flex: 1;
				display: flex;
				flex-direction: column;
				background: #252526;
			}
			.output-header {
				background: #2d2d30;
				padding: 10px 20px;
				border-bottom: 1px solid #3c3c3c;
				font-weight: bold;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.output {
				flex: 1;
				padding: 20px;
				overflow: auto;
				font-family: 'Courier New', monospace;
				white-space: pre-wrap;
				word-wrap: break-word;
			}
			.error {
				color: #f48771;
			}
			.success {
				color: #4ec9b0;
			}
			.loading {
				color: #ffd700;
			}
			.info {
				color: #569cd6;
			}
			.api-note {
				font-size: 11px;
				color: #888;
			}
		</style>
	</head>
	<body>
		<div class="header">
			<h1>⚡ Online Compiler</h1>
			<div class="controls">
				<select id="language">
					<option value="javascript">JavaScript</option>
					<option value="python">Python</option>
					<option value="cpp">C++</option>
					<option value="java">Java</option>
					<option value="html">HTML/CSS/JS</option>
				</select>
				<button id="runBtn" onclick="runCode()">▶ Run Code</button>
				<button class="clear-btn" onclick="clearOutput()">Clear Output</button>
			</div>
		</div>

		<div class="container">
			<div class="editor-section">
				<textarea id="editor"></textarea>
			</div>
			<div class="output-section">
				<div class="output-header">
					<span>Output</span>
					<span class="api-note" id="apiNote"></span>
				</div>
				<div id="output" class="output"></div>
			</div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/1.2.0/skulpt.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/1.2.0/skulpt-stdlib.min.js"></script>

		<script>
			const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
				mode: 'javascript',
				theme: 'monokai',
				lineNumbers: true,
				autoCloseBrackets: true,
				matchBrackets: true,
				indentUnit: 4,
				tabSize: 4,
				lineWrapping: true,
			})

			const examples = {
				javascript:
					'// JavaScript Example\nconsole.log("Hello, World!");\n\nfor (let i = 1; i <= 5; i++) {\n    console.log("Number: " + i);\n}\n\nconst sum = (a, b) => a + b;\nconsole.log("Sum of 5 and 3:", sum(5, 3));',
				python: '# Python Example\nprint("Hello, World!")\n\nfor i in range(1, 6):\n    print(f"Number: {i}")\n\ndef sum_numbers(a, b):\n    return a + b\n\nprint("Sum of 5 and 3:", sum_numbers(5, 3))',
				cpp: '#include <iostream>\nusing namespace std;\n\nint main() {\n    cout << "Hello, World!" << endl;\n    \n    for (int i = 1; i <= 5; i++) {\n        cout << "Number: " << i << endl;\n    }\n    \n    int sum = 5 + 3;\n    cout << "Sum of 5 and 3: " << sum << endl;\n    \n    return 0;\n}',
				java: 'public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, World!");\n        \n        for (int i = 1; i <= 5; i++) {\n            System.out.println("Number: " + i);\n        }\n        \n        int sum = sum(5, 3);\n        System.out.println("Sum of 5 and 3: " + sum);\n    }\n    \n    public static int sum(int a, int b) {\n        return a + b;\n    }\n}',
				html: '<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body { font-family: Arial; padding: 20px; }\n        h1 { color: #007acc; }\n        button { padding: 10px 20px; background: #007acc; color: white; border: none; cursor: pointer; }\n    </style>\n</head>\n<body>\n    <h1>Hello, World!</h1>\n    <button onclick="alert(\'Button clicked!\')">Click Me</button>\n    <script>\n        console.log("Page loaded!");\n    <\/script>\n</body>\n</html>',
			}

			editor.setValue(examples.javascript)

			document.getElementById('language').addEventListener('change', function () {
				const lang = this.value
				const modes = {
					javascript: 'javascript',
					python: 'python',
					cpp: 'text/x-c++src',
					java: 'text/x-java',
					html: 'htmlmixed',
				}
				editor.setOption('mode', modes[lang])
				editor.setValue(examples[lang])
				updateApiNote(lang)
			})

			function updateApiNote(lang) {
				const note = document.getElementById('apiNote')
				if (lang === 'cpp' || lang === 'java') {
					note.textContent = 'Using JDoodle API'
				} else {
					note.textContent = ''
				}
			}

			function runCode() {
				const code = editor.getValue()
				const lang = document.getElementById('language').value
				const output = document.getElementById('output')
				const runBtn = document.getElementById('runBtn')

				output.innerHTML = ''
				runBtn.disabled = true

				try {
					if (lang === 'javascript') {
						runJavaScript(code)
						runBtn.disabled = false
					} else if (lang === 'python') {
						runPython(code)
						runBtn.disabled = false
					} else if (lang === 'cpp') {
						runCompiledLanguage(code, 'cpp17', 4)
					} else if (lang === 'java') {
						runCompiledLanguage(code, 'java', 4)
					} else if (lang === 'html') {
						runHTML(code)
						runBtn.disabled = false
					}
				} catch (error) {
					output.innerHTML += '<span class="error">Error: ' + error.message + '</span>\n'
					runBtn.disabled = false
				}
			}

			function runJavaScript(code) {
				const output = document.getElementById('output')
				const originalLog = console.log
				const originalError = console.error

				console.log = function (...args) {
					output.innerHTML += '<span class="success">' + args.join(' ') + '</span>\n'
					originalLog.apply(console, args)
				}

				console.error = function (...args) {
					output.innerHTML += '<span class="error">' + args.join(' ') + '</span>\n'
					originalError.apply(console, args)
				}

				try {
					eval(code)
				} catch (error) {
					output.innerHTML += '<span class="error">Error: ' + error.message + '</span>\n'
				} finally {
					console.log = originalLog
					console.error = originalError
				}
			}

			function runPython(code) {
				const output = document.getElementById('output')

				Sk.configure({
					output: function (text) {
						output.innerHTML += '<span class="success">' + text + '</span>'
					},
					read: function (file) {
						if (
							Sk.builtinFiles === undefined ||
							Sk.builtinFiles['files'][file] === undefined
						) {
							throw "File not found: '" + file + "'"
						}
						return Sk.builtinFiles['files'][file]
					},
				})

				Sk.misceval
					.asyncToPromise(function () {
						return Sk.importMainWithBody('<stdin>', false, code, true)
					})
					.then(
						function (mod) {
							// Success
						},
						function (err) {
							output.innerHTML +=
								'<span class="error">Error: ' + err.toString() + '</span>\n'
						},
					)
			}

			async function runCompiledLanguage(code, language, versionIndex) {
				const output = document.getElementById('output')
				const runBtn = document.getElementById('runBtn')

				output.innerHTML = '<span class="loading">⏳ Compiling and running code...</span>\n'

				const data = {
					clientId: '8c387ACfd4305405cFF0f0f35d73d06d',
					clientSecret:
						'8f4e9c23df586eebf5b01f4c13ea89dc3cb6d36ba7d5a4d6f8ec6a7fba8b75e9',
					script: code,
					language: language,
					versionIndex: versionIndex.toString(),
				}

				try {
					const response = await fetch('https://api.jdoodle.com/v1/execute', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify(data),
					})

					const result = await response.json()

					output.innerHTML = ''

					if (result.output) {
						output.innerHTML +=
							'<span class="success">' + escapeHtml(result.output) + '</span>'
					}

					if (result.error) {
						output.innerHTML +=
							'<span class="error">Compilation Error:\n' +
							escapeHtml(result.error) +
							'</span>'
					}

					if (result.statusCode && result.statusCode !== 200) {
						output.innerHTML +=
							'<span class="error">Status Code: ' + result.statusCode + '</span>\n'
					}

					if (result.memory) {
						output.innerHTML +=
							'\n<span class="info">Memory: ' +
							result.memory +
							' | CPU Time: ' +
							result.cpuTime +
							's</span>'
					}
				} catch (error) {
					output.innerHTML =
						'<span class="error">Error: ' +
						error.message +
						'\n\nNote: Make sure you have internet connection. The compiler uses JDoodle API.</span>'
				} finally {
					runBtn.disabled = false
				}
			}

			function runHTML(code) {
				const output = document.getElementById('output')
				const iframe = document.createElement('iframe')
				iframe.style.width = '100%'
				iframe.style.height = '100%'
				iframe.style.border = 'none'
				iframe.style.background = 'white'

				output.innerHTML = ''
				output.appendChild(iframe)

				const iframeDoc = iframe.contentDocument || iframe.contentWindow.document
				iframeDoc.open()
				iframeDoc.write(code)
				iframeDoc.close()
			}

			function clearOutput() {
				document.getElementById('output').innerHTML = ''
			}

			function escapeHtml(text) {
				const div = document.createElement('div')
				div.textContent = text
				return div.innerHTML
			}
		</script>
	</body>
</html>
